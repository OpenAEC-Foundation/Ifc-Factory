# Contributing

## Prerequisites

- Node.js >= 20
- pnpm >= 9

## Setup

```bash
git clone https://github.com/DutchSailor/Ifc-Factory.git
cd Ifc-Factory
pnpm install
```

## Development Commands

```bash
pnpm build              # Build all packages
pnpm build:schema       # Regenerate schema from EXPRESS
pnpm test               # Run all tests
pnpm test:watch         # Watch mode
pnpm lint               # Check with Biome
pnpm lint:fix           # Auto-fix lint issues
pnpm typecheck          # TypeScript type checking
pnpm clean              # Remove dist directories
```

## Build Order

Packages must be built in dependency order. The root `pnpm build` handles this automatically.

```
1. express-parser    (Layer 0, no deps)
2. step-serializer   (Layer 0, no deps)
3. codegen           (Layer 1, depends on express-parser)
4. schema            (Layer 2, generated by codegen)
5. step-parser       (Layer 2, depends on step-serializer + schema)
6. core              (Layer 3, depends on schema + step-parser + step-serializer)
7. ifc-utils         (Layer 4, depends on core + schema)
```

## Project Structure

```
Ifc-Factory/
├── package.json                 # Root workspace
├── pnpm-workspace.yaml
├── tsconfig.json                # Shared TypeScript config
├── tsconfig.build.json          # Project references
├── vitest.config.ts             # Root test config
├── biome.json                   # Linting/formatting
├── schemas/
│   └── IFC4X3_ADD2.exp          # IFC EXPRESS schema
└── packages/
    ├── express-parser/          # EXPRESS schema parser
    ├── step-serializer/         # STEP file I/O
    ├── codegen/                 # TypeScript code generator
    ├── schema/                  # Generated IFC4X3 types
    ├── step-parser/             # Schema-aware STEP parser
    ├── core/                    # Main library
    └── ifc-utils/               # Utilities
```

## Per-Package Structure

Each package follows the same pattern:

```
packages/<name>/
├── package.json
├── tsconfig.json
├── tsup.config.ts
├── vitest.config.ts
├── src/
│   ├── index.ts                 # Barrel export
│   └── ...
└── tests/
    └── ...
```

## Adding a New Feature

1. Identify the correct package (see [[Package Reference]])
2. Create or modify source files in `src/`
3. Export new public API from `src/index.ts`
4. Add tests in `tests/`
5. Run `pnpm build && pnpm test && pnpm lint`

## Regenerating the Schema

When the IFC EXPRESS schema is updated:

1. Replace `schemas/IFC4X3_ADD2.exp` with the new schema
2. Run `pnpm build:schema`
3. Verify: `pnpm build && pnpm test`

## Code Style

- **Biome v2** for linting and formatting
- 2 space indentation
- Single quotes
- No trailing semicolons enforcement (Biome default)
- Generated code (`**/generated/**`) is excluded from linting

## Commit Messages

Use conventional commit style:
- `feat:` — New feature
- `fix:` — Bug fix
- `refactor:` — Code restructuring
- `test:` — Test additions/changes
- `docs:` — Documentation
- `chore:` — Build, CI, dependency updates

## Testing

- Tests use **Vitest**
- Place tests in `packages/<name>/tests/`
- Name test files `*.test.ts`
- Run `pnpm test` from root to run all
- Run `pnpm --filter @ifc-factory/<name> test` for a single package

## License

ISC
